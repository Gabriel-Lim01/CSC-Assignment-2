@{
    ViewData["Title"] = "Home Page";
}

@*<link rel="stylesheet" href="~/css/mystyle.css" />
    <script src="~/lib/jquery/dist/jquery.js"></script>

    <form id="form1" runat="server" style="padding-top: 50px">
        <div>
            <div id="searcharea">
                <label for="search">Talents Search</label>
                <p>Enter the name or info about a speaker</p>
                <input type="search" name="search" id="search" placeholder="name or info" />
            </div>
        </div>
    </form>

    <div id="update"></div>

    <script>
        $('#search').keyup(function () {

            var jsonData = [
                {
                    "Id": 0,
                    "Name": "Barot Bellingham",
                    "ShortName": "Barot_Bellingham",
                    "Reknown": "Royal Academy of Painting and Sculpture",
                    "Bio": "Barot has just finished his final year at The Royal Academy of Painting and Sculpture, where he excelled in glass etching paintings and portraiture. Hailed as one of the most diverse artists of his generation, Barot is equally as skilled with watercolors as he is with oils, and is just as well-balanced in different subject areas. Barot's collection entitled \"The Un-Collection\" will adorn the walls of Gilbert Hall, depicting his range of skills and sensibilities - all of them, uniquely Barot, yet undeniably different"
                },
                {
                    "Id": 1,
                    "Name": "Jonathan G. Ferrar II",
                    "ShortName": "Jonathan_Ferrar",
                    "Reknown": "Artist to Watch in 2012",
                    "Bio": "The Artist to Watch in 2012 by the London Review, Johnathan has already sold one of the highest priced-commissions paid to an art student, ever on record. The piece, entitled Gratitude Resort, a work in oil and mixed media, was sold for $750,000 and Jonathan donated all the proceeds to Art for Peace, an organization that provides college art scholarships for creative children in developing nations"
                },
                {
                    "Id": 2,
                    "Name": "Hillary Hewitt Goldwynn-Post",
                    "ShortName": "Hillary_Goldwynn",
                    "Reknown": "New York University",
                    "Bio": "Hillary is a sophomore art sculpture student at New York University, and has already won all the major international prizes for new sculptors, including the Divinity Circle, the International Sculptor's Medal, and the Academy of Paris Award. Hillary's CAC exhibit features 25 abstract watercolor paintings that contain only water images including waves, deep sea, and river."
                },
                {
                    "Id": 3,
                    "Name": "Hassum Harrod",
                    "ShortName": "Hassum_Harrod",
                    "Reknown": "Art College in New Dehli",
                    "Bio": "The Art College in New Dehli has sponsored Hassum on scholarship for his entire undergraduate career at the university, seeing great promise in his contemporary paintings of landscapes - that use equal parts muted and vibrant tones, and are almost a contradiction in art. Hassum will be speaking on \"The use and absence of color in modern art\" during Thursday's agenda."
                }
            ]

            //get data from Restful web Service in development environment
            //var urlForJson = "http://localhost:44363/api/Talents";

            //get data from Restful web Service in production environment
            //var urlForJson= "http://csc123.azurewebsites.net/api/talents";

            //Url for the Cloud image hosting
            //var urlForCloudImage = "http://res.cloudinary.com/doh5kivfn/image/upload/v1460006156/talents/";

            //var searchField = $('#search').val();
            //var myExp = new RegExp(searchField, "i");

            //var output = '<ul class="searchresults">';
            loadTalentsData();
            //$.each(jsonData, function (key, val) {
            //    if ((val.Name.search(myExp) != -1) ||
            //        (val.Bio.search(myExp) != -1)) {
            //        output += '<li>';
            //        output += '<h2>' + val.Name + '</h2>';
            //        //get the absolute path for local image
            //        //output += '<img src="images/'+ val.ShortName +'_tn.jpg" alt="'+ val.Name +'" />';

            //        //get the image from cloud hosting
            //        //output += '<img src=' + urlForCloudImage + val.ShortName + "_tn.jpg alt=" + val.Name + '" />';
            //        output += '<img src=' + 'https://talents-search.s3.amazonaws.com/' + val.ShortName + "_tn.jpg alt=" + val.Name + '" />';
            //        output += '<p>' + val.Bio + '</p>';
            //        output += '</li>';
            //    }
            //});
            //output += '</ul>';
            //$('#update').html(output);
        }); //get JSON

        function loadTalentsData() {
            $loadTalentsDataHandler = jQuery.ajax({
                url: '/api/Talents',
                method: 'GET',
                dataType: 'json',
                cache: false,
                tryCount: 0,
                retryLimit: 3,
                error: function (xhr, textStatus, errorThrown) {
                    if (textStatus == 'timeout') {
                        this.tryCount++;
                        if (this.tryCount <= this.retryLimit) {
                            //try again
                            $.ajax(this);
                            return;
                        }
                        return;
                    }
                }
            }).done(function (data, textStatus, jqXHR) {
                console.log(data);
                var talentsList = data;
                var talentId = "";
                var talent;
                var talentName = "";
                var talentShortName = "";
                var talentReknown = "";
                var talentBio = "";
                var $tableElement = null;
                var $cellElement = null;
                var $rowElement = null;
                $tableBodyElement = $('#talentsTableBody');
                var searchField = $('#search').val();
                var myExp = new RegExp(searchField, "i");

                var output = '<ul class="searchresults">';
                for (index = 0; index < talentsList.length; index++) {
                    talent = talentsList[index];
                    talentId = talent.Id;
                    talentName = talent.Name;
                    talentShortName = talent.ShortName;
                    talentReknown = talent.Reknown;
                    talentBio = talent.Bio;

                    output += '<li>';
                    output += '<h2>' + talentName + '</h2>';

                    //get the absolute path for local image
                    //output += '<img src="images/'+ val.ShortName +'_tn.jpg" alt="'+ val.Name +'" />';

                    //get the image from cloud hosting
                    //output += '<img src=' + urlForCloudImage + val.ShortName + "_tn.jpg alt=" + val.Name + '" />';
                    output += '<img src=' + 'https://talents-search.s3.amazonaws.com/' + talentShortName + "_tn.jpg alt=" + talentName + '" />';
                    output += '<p>' + talentBio + '</p>';
                    output += '</li>';

                    //$rowElement = $('<tr></tr>');
                    //$cellElement = $('<td></td>', { text: talentId });
                    //$rowElement.append($cellElement);
                    //$cellElement = $('<td></td>');
                    ////$imgElement = $(`<img src='${urlForCloudImage + talent.ShortName + "_tn.jpg"}'>`);
                    //$imgElement = $(`<img src='${talent.Photo}'>`);
                    //$cellElement.append($imgElement);
                    //$rowElement.append($cellElement);
                    //$cellElement = $('<td></td>', { text: talentName });
                    //$rowElement.append($cellElement);
                    //$cellElement = $('<td></td>', { text: talentShortName });
                    //$rowElement.append($cellElement);
                    //$hyperLinkElement = $('<a class="edit" data-toggle="modal" onclick="loadEdit(' + talentId + ')"><i class="fa fa-edit"></i></a>').attr("href", "#editModal");
                    //$cellElement = $('<td></td>');
                    //$cellElement.append($hyperLinkElement);
                    //$rowElement.append($cellElement);
                    //$hyperLinkElement = $('<a class="trigger-btn" data-toggle="modal" onclick="loadDelete(' + talentId + ')"><i class="fa fa-trash mr-1"></i></a>').attr("href", "#myModal");
                    //$cellElement = $('<td></td>');
                    //$cellElement.append($hyperLinkElement);
                    //$rowElement.append($cellElement);
                    //$hyperLinkElement = $('<a class="details" href="/Talents/Details/' + talentId + '">Details</button>').addClass('btn btn-warning');
                    //$cellElement = $('<td></td>');
                    //$cellElement.append($hyperLinkElement);
                    //$rowElement.append($cellElement);
                    //$hyperLinkElement = $('<a class="details" href="/Talents/Comment/' + talentId + '">Comment</button>').addClass('btn btn-info');
                    //$cellElement = $('<td></td>');
                    //$cellElement.append($hyperLinkElement);
                    //$rowElement.append($cellElement);
                    ////Insert the $rowElement into the table element represented by $tableElement.
                    //$tableBodyElement.append($rowElement);


                }//end of for loop.
                output += '</ul>';
                $('#update').html(output);
            }//end of JavaScript anonymous function
            )//end of the done() method;
        }


    </script>*@

<link rel="stylesheet" href="~/Scripts/fonts/fontawesome/css/fontawesome-all.css" />
<link rel="stylesheet" href="~/Scripts/fonts/material-design-iconic-font/css/materialdesignicons.min.css" />


<style>
    .list-group-item list-group-item-danger {
        width: 500px !important;
    }

    #noty_center_layout_container {
        width: 500px !important;
    }

    .modal-header .close {
        margin-top: -21px;
    }

    .modal-header-edit {
        background-color: cornflowerblue;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

        .modal-header-edit .close {
            color: white;
            text-shadow: 0 1px 0 #000;
            opacity: 2.5;
        }

    .modal-confirm {
        color: #636363;
        width: 400px;
        top: 115px;
    }

        .modal-confirm .modal-content {
            border-radius: 5px;
            border: none;
            text-align: center;
            font-size: 14px;
        }

        .modal-confirm .modal-header-delete {
            border-bottom: none;
            position: relative;
        }

        .modal-confirm h4 {
            text-align: center;
            font-size: 26px;
        }

        .modal-confirm .close {
            top: -5px;
            right: -2px;
            color: white;
            text-shadow: 0 1px 0 #000;
            opacity: 2.5;
        }

        .modal-confirm .modal-body {
            color: #999;
        }

        .modal-confirm .modal-footer {
            border: none;
            text-align: center;
            border-radius: 5px;
            font-size: 13px;
            padding: 10px 70px 25px;
        }

            .modal-confirm .modal-footer a {
                color: #999;
            }

        .modal-confirm .icon-box {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            border-radius: 50%;
            z-index: 9;
            text-align: center;
            border: 3px solid #f15e5e;
        }

            .modal-confirm .icon-box i {
                color: #f15e5e;
                font-size: 46px;
                display: inline-block;
                margin-top: 3px;
                margin-right: 0;
            }

    .modal-header-delete {
        background-color: #f15e5e;
        margin-bottom: 10px;
    }

    .trigger-btn {
        display: inline-block;
        margin-left: 13px;
        color: red;
    }

    .edit, .edit:hover {
        color: blue;
    }

    .imgContainer {
        position: relative;
    }

    #uploadhover {
        cursor: pointer;
    }

    .editImgbutton {
        position: absolute;
        width: 200px;
        left: 0;
        top: 80px;
        text-align: center;
        opacity: 0;
        transition: opacity .35s ease;
    }

        .editImgbutton a {
            width: 200px;
            padding: 12px 48px;
            text-align: center;
            color: white;
            background-color: rgba(71, 143, 225, 0.8);
            z-index: 4;
            font-size: 0.85rem;
        }

    .imgContainer:hover .editImgbutton {
        opacity: 1;
    }
</style>
<div class="panel  panel-primary">
    <div class="panel-heading">
        Manage Session Synopses
        <div class="btn-group pull-right" style="margin-top: -7px;">
            <button href="#exampleModal" class="btn btn-default btn-group-lg " data-toggle="modal" data-target="#exampleModal">Add Talent</button>
        </div>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>id</th>
                            <th>Photo</th>
                            <th>Name</th>
                            <th>Short Name</th>
                            <th>Edit</th>
                            <th>Delete</th>
                            <th>Details</th>
                            <th>Comment</th>
                        </tr>
                    </thead>
                    <tbody id="talentsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create Talent Record</h5>
                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
            </div>
            <div class="modal-body">
                <form id="dataForm" role="form" class="form-horizontal">
                    <input onchange="return fileValidation()" type="file" id="fileInput" style="padding: 2px;" />
                    <div class="form-group">
                        <div class="imgContainer" style="display:none;">
                            <img id="changeImage" style="width:200px;" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="TalentNameInput">Name</label>
                        <div class="col-md-5">
                            <input type="text" id="TalentNameInput" name="TalentNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="TalentShortNameInput">Short Name</label>
                        <div class="col-md-5">
                            <input type="text" id="TalentShortNameInput" name="TalentShortNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="TalentReknownInput">Reknown</label>
                        <div class="col-md-5">
                            <input type="text" id="TalentReknownInput" name="TalentReknownInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="TalentBioInput">Bio</label>
                        <div class="col-md-5">
                            <textarea id="TalentBioInput" name="TalentBioInput" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" onclick="addRecord();" class="btn btn-primary" value="Add" id="addButton"><i class="fa fa-spinner fa-spin fa-2x hidden" id="createSpinner" style="margin-right:5px;"></i>Add</button>
                        <button type="reset" class="btn btn-grey">Clear</button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<!-- Details Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-details" style="background-color:antiquewhite">
                <h5 class="modal-title" id="exampleModalLabel" style="color:black;">Details</h5>
                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
            </div>
            <div class="modal-body">
                <form role="form" id="detailsModalForm" class="form-horizontal">
                    <div class="form-group">
                        <div class="col-md-5">
                            <img id="DetailsTalentpicInput" name="DetailsTalentpicInput" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="DetailsTalentNameInput">Name</label>
                        <div class="col-md-5">
                            <input type="text" id="DetailsTalentNameInput" name="DetailsTalentNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" disabled />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="DetailsTalentShortNameInput">Short Name</label>
                        <div class="col-md-5">
                            <input type="text" id="DetailsTalentShortNameInput" name="DetailsTalentShortNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" disabled />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="DetailsTalentReknownInput">Rekown</label>
                        <div class="col-md-5">
                            <input type="text" id="DetailsTalentReknownInput" name="DetailsTalentReknownInput" class="form-control input-group-sm"
                                   maxlength="30" value="" disabled />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="DetailsTalentBioInput">Bio</label>
                        <div class="col-md-5">
                            <textarea id="DetailsTalentBioInput" name="DetailsTalentBioInput" class="form-control" disabled></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info" data-dismiss="modal">Back</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header modal-header-edit">
                <h5 class="modal-title" id="exampleModalLabel" style="color:white;">Edit Item</h5>
                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
            </div>
            <div class="modal-body">
                <form role="form" id="editModalForm" class="form-horizontal">
                    <div class="imgContainer">
                        <img alt="upload" style="width:200px; margin-top: -14px;" id="editPhoto">
                        <div onclick="$('#newphoto').click();" class="editImgbutton"><a href="#"> Change Photo </a></div>
                        <input id='newphoto' onchange="editPhotoFunction(this); del = true;" type='file' style="display: none;" />
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="UpdateTalentNameInput">Name</label>
                        <div class="col-md-5">
                            <input type="text" id="UpdateTalentNameInput" name="UpdateTalentNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="UpdateTalentShortNameInput">Short Name</label>
                        <div class="col-md-5">
                            <input type="text" id="UpdateTalentShortNameInput" name="UpdateTalentShortNameInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="UpdateTalentReknownInput">Reknown</label>
                        <div class="col-md-5">
                            <input type="text" id="UpdateTalentReknownInput" name="UpdateTalentReknownInput" class="form-control input-group-sm"
                                   maxlength="30" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-5" for="UpdateTalentBioInput">Bio</label>
                        <div class="col-md-5">
                            <textarea id="UpdateTalentBioInput" name="UpdateTalentBioInput" class="form-control"></textarea>
                        </div>
                    </div>
                    <input type="hidden" id="editId" />
                    <div class="modal-footer">
                        <button type="reset" class="btn btn-grey" onclick="resetEdit()">Reset</button>
                        <button type="button" onclick="updateTalent()" class="btn btn-success" value="Save" id="saveButton"><i class="fa fa-spinner fa-spin fa-2x hidden" id="updateEditSpinner" style="margin-right:5px;"></i>Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div id="myModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header modal-header-delete">
                <h5 class="modal-title" id="exampleModalLabel" style="color:white;">Delete Talent Record</h5>
                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
            </div>
            <div class="icon-box">
                <i class="m-r-10 mdi mdi-close"></i>
            </div>
            <div class="modal-body">
                <p id="deleteRec"></p>
                <input type="hidden" id="deleteId" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                <button type="button" onclick="deleteRecord()" id="DeleteTalent" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        loadTalentsData();
        //Bucket Configurations
        //var bucketName = 'spcscca2';
        //var bucketRegion = 'us-east-1';
        //var IdentityPoolId = "us-east-1:a20b1a53-df5c-4c6f-b110-e06d14830c69";
        //AWS.config.update({
        //    region: bucketRegion,
        //    credentials: new AWS.CognitoIdentityCredentials({
        //        IdentityPoolId: IdentityPoolId
        //    })
        //});
        //var s3 = new AWS.S3({
        //    apiVersion: '2006-03-01',
        //    params: { Bucket: bucketName }
        //});
        //function addRecord() {
        //    var s3 = new AWS.S3({
        //        params: { Bucket: 'spcscca2' }
        //    });
        //    var file = document.getElementById('fileInput').files[0];
        //    var fileUrl = 'https://' + bucketName + '.s3.amazonaws.com/' + file.name;

        //    if (file) {
        //        console.log("ready to upload!");
        //        s3.putObject({
        //            Key: file.name,
        //            ContentType: file.type,
        //            Body: file,
        //            ACL: "public-read"
        //        },
        //            function (err, data) {
        //                if (data !== null) {
        //                    alert("Got it!");
        //                    uploadToRDS(fileUrl);
        //                }
        //                else {
        //                    alert("Upload failed!");
        //                }
        //            });
        //    }
        //    else {
        //        console.log("cannot find");
        //    }
        //}
        function loadTalentsData() {
            $loadTalentsDataHandler = jQuery.ajax({
                url: '/api/Talents',
                method: 'GET',
                dataType: 'json',
                cache: false,
                tryCount: 0,
                retryLimit: 3,
                error: function (xhr, textStatus, errorThrown) {
                    if (textStatus == 'timeout') {
                        this.tryCount++;
                        if (this.tryCount <= this.retryLimit) {
                            //try again
                            $.ajax(this);
                            return;
                        }
                        return;
                    }
                }
            }).done(function (data, textStatus, jqXHR) {
                console.log(data);
                var talentsList = data;
                var talentId = "";
                var talent;
                var talentName = "";
                var talentShortName = "";
                var talentReknown = "";
                var talentBio = "";
                var $tableElement = null;
                var $cellElement = null;
                var $rowElement = null;
                $tableBodyElement = $('#talentsTableBody');
                for (index = 0; index < talentsList.length; index++) {
                    talent = talentsList[index];
                    talentId = talent.id;
                    talentName = talent.name;
                    talentShortName = talent.shortName;
                    talentReknown = talent.reknown;
                    talentBio = talent.bio;
                    $rowElement = $('<tr></tr>');
                    $cellElement = $('<td></td>', { text: talentId });
                    $rowElement.append($cellElement);
                    $cellElement = $('<td></td>');
                    //$imgElement = $(`<img src='${urlForCloudImage + talent.ShortName + "_tn.jpg"}'>`);
                    $imgElement = $(`<img src='${talent.Photo}'>`);
                    $cellElement.append($imgElement);
                    $rowElement.append($cellElement);
                    $cellElement = $('<td></td>', { text: talentName });
                    $rowElement.append($cellElement);
                    $cellElement = $('<td></td>', { text: talentShortName });
                    $rowElement.append($cellElement);
                    $hyperLinkElement = $('<a class="edit" data-toggle="modal" onclick="loadEdit(' + talentId + ')"><i class="fa fa-edit"></i></a>').attr("href", "#editModal");
                    $cellElement = $('<td></td>');
                    $cellElement.append($hyperLinkElement);
                    $rowElement.append($cellElement);
                    $hyperLinkElement = $('<a class="trigger-btn" data-toggle="modal" onclick="loadDelete(' + talentId + ')"><i class="fa fa-trash mr-1"></i></a>').attr("href", "#myModal");
                    $cellElement = $('<td></td>');
                    $cellElement.append($hyperLinkElement);
                    $rowElement.append($cellElement);
                    $hyperLinkElement = $('<a class="details" href="/Talents/Details/' + talentId + '">Details</button>').addClass('btn btn-warning');
                    $cellElement = $('<td></td>');
                    $cellElement.append($hyperLinkElement);
                    $rowElement.append($cellElement);
                    $hyperLinkElement = $('<a class="details" href="/Talents/Comment/' + talentId + '">Comment</button>').addClass('btn btn-info');
                    $cellElement = $('<td></td>');
                    $cellElement.append($hyperLinkElement);
                    $rowElement.append($cellElement);
                    //Insert the $rowElement into the table element represented by $tableElement.
                    $tableBodyElement.append($rowElement);
                }//end of for loop.
            }//end of JavaScript anonymous function
            )//end of the done() method;
        }
        /**/
        </script>
}
